/* 
 * File:   pitch_core.h
 * Author: vm-user
 *
 * Created on January 7, 2012, 7:21 PM
 */

#ifndef PITCH_CORE_H
#define	PITCH_CORE_H

#ifdef	__cplusplus
extern "C" {
#endif
    
#include <math.h>
#include "../constants.h"
#include "interpolate-linear.h"

/*Forward declaration of functions*/

inline float f_pit_midi_note_to_hz(float);    
inline float f_pit_hz_to_midi_note(float);
inline float f_pit_midi_note_to_hz_fast(float);

/*Functions*/

inline float f_pit_midi_note_to_hz(float a_midi_note_number)
{
    float f_result;
    f_result = base_a4*pow(2,(a_midi_note_number-57)*.0833333);
    return f_result;
}

inline float f_pit_hz_to_midi_note(float _hz)
{
    float f_result=(12*log2(_hz*base_a4_recip))+57;
    return f_result;
}

/*Arrays*/

#define arr_pit_p2f_count_limit 1250

#define arr_pit_p2f_count 1271
#define arr_pit_p2f_count_m1 1270

float arr_pit_p2f [arr_pit_p2f_count] = {
16.351620,16.446342,16.541616,16.637440,16.733822,16.830759,16.928257,17.026323,17.124954,17.224159,
17.323936,17.424292,17.525232,17.626753,17.728867,17.831566,17.934862,18.038761,18.143255,18.248362,
18.354071,18.460394,18.567337,18.674894,18.783079,18.891886,19.001324,19.111401,19.222111,19.333460,
19.445461,19.558105,19.671408,19.785360,19.899975,20.015257,20.131201,20.247818,20.365116,20.483088,
20.601748,20.721090,20.841125,20.961859,21.083288,21.205425,21.328264,21.451817,21.576088,21.701075,
21.826786,21.953230,22.080402,22.208311,22.336964,22.466360,22.596508,22.727407,22.859062,22.991488,
23.124674,23.258636,23.393370,23.528885,23.665190,23.802279,23.940161,24.078848,24.218332,24.358627,
24.499737,24.641661,24.784412,24.927984,25.072388,25.217634,25.363716,25.510651,25.658430,25.807066,
25.956568,26.106930,26.258169,26.410278,26.563269,26.717152,26.871927,27.027592,27.184158,27.341639,
27.500031,27.659334,27.819561,27.980721,28.142815,28.305843,28.469814,28.634741,28.800625,28.967463,
29.135267,29.304049,29.473810,29.644547,29.816273,29.989002,30.162729,30.337458,30.513199,30.689964,
30.867752,31.046564,31.226414,31.407310,31.589254,31.772247,31.956299,32.141422,32.327621,32.514889,
32.703243,32.892696,33.083244,33.274891,33.467648,33.661530,33.856533,34.052658,34.249920,34.448334,
34.647896,34.848606,35.050476,35.253529,35.457752,35.663155,35.869747,36.077541,36.286541,36.496746,
36.708164,36.920818,37.134705,37.349819,37.566181,37.783806,38.002689,38.222832,38.444252,38.666962,
38.890961,39.116253,39.342846,39.570763,39.799999,40.030556,40.262444,40.495689,40.730282,40.966228,
41.203537,41.442234,41.682312,41.923771,42.166630,42.410904,42.656593,42.903694,43.152229,43.402214,
43.653645,43.906525,44.160870,44.416695,44.674004,44.932796,45.193085,45.454891,45.718216,45.983051,
46.249428,46.517353,46.786831,47.057861,47.330460,47.604649,47.880424,48.157787,48.436760,48.717358,
48.999580,49.283428,49.568920,49.856075,50.144894,50.435379,50.727543,51.021412,51.316982,51.614254,
51.913246,52.213982,52.516464,52.820683,53.126663,53.434433,53.743980,54.055313,54.368446,54.683407,
55.000191,55.318798,55.639252,55.961575,56.285763,56.611820,56.939762,57.269619,57.601387,57.935062,
58.270672,58.608238,58.947758,59.289234,59.632687,59.978146,60.325603,60.675060,61.026543,61.380074,
61.735653,62.093277,62.452972,62.814770,63.178658,63.544643,63.912746,64.282997,64.655396,65.029938,
65.406647,65.785545,66.166649,66.549942,66.935455,67.323219,67.713226,68.105476,68.500000,68.896828,
69.295944,69.697372,70.101128,70.507225,70.915665,71.326477,71.739670,72.155258,72.573250,72.993660,
73.416512,73.841812,74.269569,74.699814,75.132545,75.567787,76.005547,76.445847,76.888695,77.334106,
77.782097,78.232689,78.685890,79.141708,79.600174,80.061295,80.525085,80.991570,81.460747,81.932648,
82.407280,82.884659,83.364807,83.847740,84.333466,84.822006,85.313377,85.807594,86.304672,86.804634,
87.307487,87.813255,88.321960,88.833603,89.348213,89.865807,90.386391,90.909996,91.436638,91.966324,
92.499084,93.034927,93.573875,94.115944,94.661156,95.209518,95.761063,96.315804,96.873756,97.434944,
97.999382,98.567085,99.138084,99.712387,100.290016,100.870995,101.455338,102.043060,102.634193,103.228752,
103.826736,104.428192,105.033127,105.641571,106.253532,106.869041,107.488121,108.110786,108.737053,109.366951,
110.000496,110.637711,111.278618,111.923241,112.571594,113.223709,113.879593,114.539284,115.202789,115.870140,
116.541359,117.216469,117.895485,118.578438,119.265343,119.956230,120.651115,121.350029,122.052994,122.760033,
123.471161,124.186409,124.905800,125.629364,126.357117,127.089081,127.825294,128.565765,129.310532,130.059601,
130.813019,131.570801,132.332962,133.099548,133.870575,134.646072,135.426056,136.210556,136.999603,137.793228,
138.591446,139.394287,140.201767,141.013931,141.830811,142.652420,143.478775,144.309937,145.145889,145.986710,
146.832382,147.682968,148.538467,149.398926,150.264374,151.134827,152.010330,152.890900,153.776581,154.667389,
155.563354,156.464508,157.370880,158.282501,159.199417,160.121628,161.049194,161.982132,162.920471,163.864243,
164.813477,165.768219,166.728485,167.694321,168.665756,169.642807,170.625519,171.613937,172.608063,173.607956,
174.613647,175.625153,176.642517,177.665787,178.694977,179.730133,180.771286,181.818466,182.871704,183.931061,
184.996536,186.068192,187.146057,188.230179,189.320557,190.417267,191.520325,192.629776,193.745651,194.867996,
195.996826,197.132217,198.274170,199.422745,200.577972,201.739883,202.908539,204.083954,205.266174,206.455261,
207.651215,208.854111,210.063980,211.280838,212.504761,213.735764,214.973907,216.219223,217.471741,218.731522,
219.998611,221.273026,222.554825,223.844055,225.140747,226.444962,227.756714,229.076080,230.403076,231.737778,
233.080200,234.430389,235.788406,237.154297,238.528091,239.909851,241.299622,242.697433,244.103348,245.517395,
246.939636,248.370117,249.808899,251.255997,252.711487,254.175415,255.647812,257.128723,258.618256,260.116394,
261.623199,263.138733,264.663055,266.196228,267.738251,269.289215,270.849182,272.418152,273.996246,275.583466,
277.179871,278.785522,280.400482,282.024811,283.658539,285.301727,286.954437,288.616730,290.288635,291.970245,
293.661591,295.362732,297.073700,298.794617,300.525482,302.266388,304.017365,305.778503,307.549835,309.331421,
311.123322,312.925629,314.738342,316.561584,318.395386,320.239777,322.094879,323.960724,325.837402,327.724915,
329.623383,331.532837,333.453369,335.385010,337.327850,339.281921,341.247345,343.224121,345.212372,347.212158,
349.223480,351.246490,353.281219,355.327728,357.386078,359.456360,361.538635,363.632965,365.739441,367.858124,
369.989075,372.132355,374.288055,376.456268,378.637024,380.830414,383.036499,385.255371,387.487091,389.731750,
391.989410,394.260132,396.544037,398.841156,401.151581,403.475403,405.812653,408.163483,410.527893,412.906036,
415.297943,417.703705,420.123383,422.557098,425.004913,427.466888,429.943146,432.433746,434.938782,437.458313,
439.992432,442.541260,445.104828,447.683258,450.276611,452.885010,455.508484,458.147186,460.801147,463.470520,
466.155334,468.855682,471.571716,474.303436,477.051025,479.814514,482.593994,485.389587,488.201385,491.029449,
493.873932,496.734863,499.612366,502.506561,505.417480,508.345306,511.290070,514.251892,517.230896,520.227112,
523.240723,526.271790,529.320374,532.386658,535.470703,538.572571,541.692444,544.830383,547.986511,551.160950,
554.353699,557.565002,560.794922,564.043518,567.310913,570.597290,573.902649,577.227173,580.570984,583.934143,
587.316772,590.718994,594.140991,597.582764,601.044434,604.526184,608.028137,611.550354,615.092957,618.656128,
622.239868,625.844421,629.469849,633.116272,636.783813,640.472656,644.182800,647.914429,651.667725,655.442749,
659.239624,663.058472,666.899475,670.762756,674.648376,678.556519,682.487244,686.440796,690.417297,694.416748,
698.439392,702.485352,706.554749,710.647705,714.764404,718.904907,723.069397,727.258057,731.470947,735.708252,
739.970093,744.256653,748.567993,752.904358,757.265808,761.652527,766.064697,770.502380,774.965759,779.455017,
783.970337,788.511719,793.079468,797.673645,802.294434,806.942017,811.616516,816.318115,821.046875,825.803101,
830.586853,835.398315,840.237671,845.105042,850.000610,854.924500,859.876953,864.858093,869.868103,874.907104,
879.975342,885.072876,890.200012,895.356750,900.543457,905.760132,911.007080,916.284424,921.592346,926.930969,
932.300537,937.701233,943.133179,948.596619,954.091675,959.618591,965.177490,970.768677,976.392151,982.048279,
987.737122,993.458923,999.213867,1005.002197,1010.824036,1016.679565,1022.569031,1028.492676,1034.450562,1040.442993,
1046.470093,1052.532104,1058.629272,1064.761719,1070.929810,1077.133545,1083.373169,1089.649048,1095.961182,1102.309937,
1108.695435,1115.117920,1121.577637,1128.074829,1134.609497,1141.182129,1147.792847,1154.441895,1161.129395,1167.855591,
1174.620850,1181.425171,1188.269043,1195.152466,1202.075806,1209.039307,1216.043091,1223.087402,1230.172607,1237.298828,
1244.466309,1251.675293,1258.926025,1266.218872,1273.553833,1280.931396,1288.351562,1295.814819,1303.321289,1310.871216,
1318.464966,1326.102539,1333.784546,1341.510864,1349.282104,1357.098267,1364.959717,1372.866699,1380.819580,1388.818481,
1396.863647,1404.955444,1413.094116,1421.280029,1429.513306,1437.794189,1446.123169,1454.500366,1462.926025,1471.400513,
1479.924194,1488.497070,1497.119751,1505.792358,1514.515137,1523.288574,1532.112671,1540.988037,1549.914795,1558.893188,
1567.923584,1577.006348,1586.141724,1595.329956,1604.571533,1613.866577,1623.215454,1632.618408,1642.075928,1651.588257,
1661.155640,1670.778564,1680.457031,1690.191772,1699.982788,1709.830444,1719.735229,1729.697388,1739.717285,1749.795288,
1759.931519,1770.126587,1780.380615,1790.694092,1801.067383,1811.500610,1821.994385,1832.548950,1843.164673,1853.841797,
1864.580811,1875.382080,1886.245850,1897.172607,1908.162598,1919.216309,1930.334106,1941.516235,1952.763184,1964.075195,
1975.452759,1986.896240,1998.406128,2009.982544,2021.626099,2033.337036,2045.115845,2056.962891,2068.878662,2080.863281,
2092.917480,2105.041504,2117.235596,2129.500488,2141.836182,2154.243652,2166.722900,2179.274414,2191.898438,2204.595947,
2217.366699,2230.211670,2243.130859,2256.125000,2269.194336,2282.339600,2295.560791,2308.858643,2322.233398,2335.685791,
2349.216064,2362.824707,2376.512207,2390.279053,2404.125488,2418.052246,2432.059814,2446.148193,2460.318604,2474.570801,
2488.905518,2503.323486,2517.824707,2532.410156,2547.080078,2561.834961,2576.675293,2591.601562,2606.614258,2621.714111,
2636.901123,2652.176270,2667.540039,2682.992676,2698.534912,2714.166992,2729.889893,2745.703613,2761.609131,2777.606689,
2793.697021,2809.880371,2826.157715,2842.529053,2858.995605,2875.557129,2892.214844,2908.968994,2925.820312,2942.769043,
2959.816162,2976.961914,2994.207031,3011.552002,3028.997559,3046.543945,3064.192139,3081.942627,3099.795898,3117.752441,
3135.813232,3153.978516,3172.249023,3190.625244,3209.108154,3227.697998,3246.395508,3265.201416,3284.116211,3303.140625,
3322.275391,3341.520752,3360.877686,3380.346680,3399.928467,3419.623779,3439.433105,3459.357422,3479.396973,3499.552490,
3519.824951,3540.214600,3560.722656,3581.349365,3602.095703,3622.961914,3643.949219,3665.058105,3686.289307,3707.643311,
3729.121094,3750.723389,3772.450928,3794.303955,3816.283936,3838.391113,3860.626221,3882.990234,3905.483887,3928.107666,
3950.862793,3973.749512,3996.768799,4019.921387,4043.208252,4066.629883,4090.187256,4113.881348,4137.712402,4161.681641,
4185.789551,4210.037109,4234.425293,4258.954590,4283.625977,4308.440430,4333.398438,4358.501465,4383.749512,4409.144043,
4434.685547,4460.375000,4486.213379,4512.201172,4538.339844,4564.629395,4591.071777,4617.666992,4644.416504,4671.320801,
4698.381348,4725.598145,4752.973145,4780.506348,4808.199219,4836.052246,4864.066895,4892.243652,4920.583496,4949.087891,
4977.757324,5006.592285,5035.594727,5064.765137,5094.104980,5123.614258,5153.294434,5183.146973,5213.171875,5243.371094,
5273.745117,5304.295410,5335.021973,5365.927246,5397.011230,5428.275391,5459.720215,5491.347656,5523.158203,5555.153320,
5587.333496,5619.699707,5652.253906,5684.996582,5717.929199,5751.052246,5784.367188,5817.875000,5851.577148,5885.474609,
5919.567871,5953.859375,5988.349121,6023.038574,6057.929199,6093.021973,6128.317871,6163.818359,6199.524414,6235.437500,
6271.558105,6307.888672,6344.429199,6381.181641,6418.146484,6455.326172,6492.720703,6530.332031,6568.161133,6606.209473,
6644.478516,6682.968750,6721.682617,6760.620117,6799.783203,6839.173340,6878.791992,6918.639648,6958.718262,6999.028809,
7039.573242,7080.352539,7121.368164,7162.621094,7204.112793,7245.845215,7287.819336,7330.036621,7372.498535,7415.206055,
7458.161621,7501.365234,7544.819824,7588.525879,7632.484863,7676.698730,7721.168945,7765.896484,7810.882812,7856.130371,
7901.639648,7947.412598,7993.450684,8039.755859,8086.328613,8133.171875,8180.286133,8227.672852,8275.334961,8323.272461,
8371.488281,8419.982422,8468.758789,8517.816406,8567.159180,8616.787109,8666.703125,8716.908203,8767.404297,8818.192383,
8869.274414,8920.653320,8972.329102,9024.304688,9076.581055,9129.160156,9182.043945,9235.234375,9288.732422,9342.541016,
9396.660156,9451.093750,9505.842773,9560.909180,9616.293945,9671.999023,9728.028320,9784.380859,9841.060547,9898.068359,
9955.406250,10013.076172,10071.080078,10129.420898,10188.098633,10247.117188,10306.477539,10366.180664,10426.230469,10486.627930,
10547.375977,10608.475586,10669.928711,10731.737305,10793.905273,10856.432617,10919.322266,10982.576172,11046.196289,11110.185547,
11174.544922,11239.277344,11304.384766,11369.870117,11435.733398,11501.979492,11568.608398,11635.624023,11703.027344,11770.821289,
11839.007812,11907.588867,11976.568359,12045.946289,12115.726562,12185.911133,12256.502930,12327.502930,12398.914062,12470.739258,
12542.980469,12615.639648,12688.720703,12762.224609,12836.154297,12910.511719,12985.300781,13060.522461,13136.179688,13212.276367,
13288.812500,13365.792969,13443.218750,13521.093750,13599.418945,13678.198242,13757.434570,13837.128906,13917.285156,13997.906250,
14078.994141,14160.551758,14242.581055,14325.086914,14408.069336,14491.533203,14575.480469,14659.914062,14744.836914,14830.251953,
14916.161133,15002.568359,15089.475586,15176.886719,15264.804688,15353.230469,15442.169922,15531.624023,15621.596680,15712.089844,
15803.107422,15894.652344,15986.728516,16079.336914,16172.482422,16266.166992,16360.394531,16455.167969,16550.490234,16646.365234,
16742.794922,16839.783203,16937.333984,17035.449219,17134.132812,17233.388672,17333.218750,17433.626953,17534.617188,17636.193359,
17738.357422,17841.111328,17944.462891,18048.412109,18152.964844,18258.121094,18363.888672,18470.267578,18577.263672,18684.878906,
18793.117188,18901.982422,19011.478516,19121.609375,19232.378906,19343.789062,19455.843750,19568.548828,19681.906250,19795.921875,
19910.595703,20025.935547,20141.943359,20258.621094,20375.976562,20494.011719,20612.730469,20732.136719,20852.234375,20973.029297,
21094.523438,21216.720703,21339.625000,21463.242188,21587.576172,21712.628906,21838.408203,21964.914062,22092.154297,22220.130859,
22348.847656,22478.312500,22608.525391,22739.492188,22871.218750,23003.708984,23136.966797,23270.994141,23405.800781,23541.386719,
23677.757812,23814.919922,23952.876953,24091.630859,24231.191406,24371.558594,24512.740234,24654.738281,24797.558594,24941.207031,
25085.687500};

inline float f_pit_midi_note_to_hz_fast(float a_midi_note_number)
{
    a_midi_note_number = (a_midi_note_number * 10) - 1;
    
    
    if(a_midi_note_number > arr_pit_p2f_count_limit)
    {
        a_midi_note_number = arr_pit_p2f_count_limit ;
    }
    
    if(a_midi_note_number < 0)
        a_midi_note_number = 0;
    
    return f_linear_interpolate_arr(arr_pit_p2f, a_midi_note_number);
}

#ifdef	__cplusplus
}
#endif

#endif	/* PITCH_CORE_H */

