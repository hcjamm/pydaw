/* 
 * File:   pitch_core.h
 * Author: vm-user
 *
 * Created on January 7, 2012, 7:21 PM
 */

#ifndef PITCH_CORE_H
#define	PITCH_CORE_H

#ifdef	__cplusplus
extern "C" {
#endif
    
#include <math.h>
#include "../constants.h"
#include "interpolate-linear.h"

/*Forward declaration of functions*/

inline float f_pit_midi_note_to_hz(float);    
inline float f_pit_hz_to_midi_note(float);
inline float f_pit_midi_note_to_hz_fast(float);

/*Functions*/

inline float f_pit_midi_note_to_hz(float a_midi_note_number)
{
    float f_result;
    f_result = base_a4*pow(2,(a_midi_note_number-57)*.0833333);
    return f_result;
}

inline float f_pit_hz_to_midi_note(float _hz)
{
    float f_result=(12*log2(_hz*base_a4_recip))+57;
    return f_result;
}

/*Arrays*/

#define arr_pit_p2f_count 518

float arr_pit_p2f [arr_pit_p2f_count] = {
16.351620,
16.589458,
16.830759,
17.075567,
17.323936,
17.575920,
17.831566,
18.090933,
18.354071,
18.621037,
18.891886,
19.166676,
19.445461,
19.728302,
20.015257,
20.306385,
20.601748,
20.901407,
21.205425,
21.513865,
21.826790,
22.144268,
22.466364,
22.793144,
23.124680,
23.461035,
23.802282,
24.148495,
24.499743,
24.856100,
25.217640,
25.584438,
25.956573,
26.334120,
26.717159,
27.105768,
27.500031,
27.900028,
28.305843,
28.717560,
29.135267,
29.559050,
29.988995,
30.425194,
30.867739,
31.316721,
31.772232,
32.234371,
32.703228,
33.178909,
33.661507,
34.151123,
34.647865,
35.151829,
35.663124,
36.181854,
36.708134,
37.242065,
37.783764,
38.333340,
38.890911,
39.456593,
40.030502,
40.612759,
41.203484,
41.802803,
42.410839,
43.027718,
43.653568,
44.288525,
44.932716,
45.586277,
46.249344,
46.922058,
47.604553,
48.296978,
48.999474,
49.712185,
50.435265,
51.168865,
51.913132,
52.668224,
53.434303,
54.211521,
55.000046,
55.800041,
56.611668,
57.435104,
58.270515,
59.118080,
59.977974,
60.850372,
61.735462,
62.633423,
63.544449,
64.468719,
65.406441,
66.357796,
67.322998,
68.302231,
69.295708,
70.303635,
71.326225,
72.363693,
73.416245,
74.484108,
75.567505,
76.666656,
77.781799,
78.913162,
80.060982,
81.225494,
82.406944,
83.605583,
84.821648,
86.055412,
87.307114,
88.577026,
89.865410,
91.172531,
92.498665,
93.844086,
95.209084,
96.593925,
97.998917,
99.424347,
100.870506,
102.337700,
103.826233,
105.336418,
106.868576,
108.423012,
110.000061,
111.600052,
113.223305,
114.870178,
116.541000,
118.236130,
119.955910,
121.700714,
123.470886,
125.266815,
127.088860,
128.937408,
130.812851,
132.715561,
134.645950,
136.604416,
138.591385,
140.607239,
142.652420,
144.727341,
146.832443,
148.968170,
151.134964,
153.333267,
155.563553,
157.826279,
160.121918,
162.450943,
164.813843,
167.211121,
169.643250,
172.110779,
174.614182,
177.154007,
179.730759,
182.345001,
184.997269,
187.688126,
190.418106,
193.187805,
195.997787,
198.848633,
201.740952,
204.675339,
207.652405,
210.672791,
213.737091,
216.845963,
220.000061,
223.200027,
226.446548,
229.740295,
233.081940,
236.472198,
239.911758,
243.401352,
246.941711,
250.533554,
254.177643,
257.874756,
261.625610,
265.431061,
269.291840,
273.208771,
277.182678,
281.214386,
285.304749,
289.454590,
293.664825,
297.936279,
302.269836,
306.666473,
311.127014,
315.652466,
320.243744,
324.901794,
329.627594,
334.422150,
339.286407,
344.221436,
349.228271,
354.307892,
359.461426,
364.689911,
369.994446,
375.376129,
380.836121,
386.375488,
391.995453,
397.697144,
403.481781,
409.350555,
415.304718,
421.345459,
427.474060,
433.691803,
440.000000,
446.399933,
452.892975,
459.480469,
466.163757,
472.944244,
479.823395,
486.802582,
493.883270,
501.066986,
508.355164,
515.749329,
523.251099,
530.861938,
538.583496,
546.417419,
554.365234,
562.428650,
570.609375,
578.909058,
587.329468,
595.872375,
604.539551,
613.332764,
622.253906,
631.304749,
640.487305,
649.803406,
659.255005,
668.844116,
678.572632,
688.442688,
698.456360,
708.615601,
718.922668,
729.379639,
739.988708,
750.752075,
761.671997,
772.750793,
783.990662,
795.394104,
806.963379,
818.700928,
830.609192,
842.690674,
854.947876,
867.383362,
879.999756,
892.799622,
905.785706,
918.960632,
932.327271,
945.888245,
959.646484,
973.604858,
987.766296,
1002.133667,
1016.710022,
1031.498413,
1046.501953,
1061.723633,
1077.166748,
1092.834473,
1108.730103,
1124.856934,
1141.218384,
1157.817749,
1174.658569,
1191.744385,
1209.078735,
1226.665161,
1244.507446,
1262.609131,
1280.974243,
1299.606445,
1318.509644,
1337.687866,
1357.144897,
1376.885010,
1396.912231,
1417.230835,
1437.844971,
1458.758789,
1479.976929,
1501.503784,
1523.343628,
1545.501099,
1567.980957,
1590.787720,
1613.926270,
1637.401367,
1661.217896,
1685.380859,
1709.895264,
1734.766235,
1759.999023,
1785.598755,
1811.570923,
1837.920776,
1864.653931,
1891.776001,
1919.292480,
1947.209229,
1975.531982,
2004.266724,
2033.419556,
2062.996338,
2093.003174,
2123.446533,
2154.332764,
2185.668457,
2217.459717,
2249.713379,
2282.436035,
2315.635010,
2349.316650,
2383.488037,
2418.156738,
2453.329590,
2489.014160,
2525.217773,
2561.947754,
2599.212158,
2637.018555,
2675.374756,
2714.289062,
2753.769287,
2793.823730,
2834.460938,
2875.688965,
2917.516846,
2959.953125,
3003.006592,
3046.686279,
3091.001465,
3135.960938,
3181.574707,
3227.851562,
3274.801758,
3322.434814,
3370.760742,
3419.789551,
3469.531494,
3519.997070,
3571.196533,
3623.140869,
3675.840576,
3729.306885,
3783.550781,
3838.583984,
3894.417480,
3951.062988,
4008.532471,
4066.837891,
4125.991211,
4186.005371,
4246.892090,
4308.664551,
4371.335449,
4434.917969,
4499.425293,
4564.871094,
4631.268555,
4698.631836,
4766.975098,
4836.312012,
4906.657715,
4978.026855,
5050.434082,
5123.894043,
5198.422852,
5274.035645,
5350.748047,
5428.576660,
5507.537109,
5587.645996,
5668.920410,
5751.376465,
5835.032227,
5919.904785,
6006.011719,
6093.371094,
6182.000977,
6271.920410,
6363.147461,
6455.701660,
6549.602051,
6644.868164,
6741.519531,
6839.577148,
6939.061035,
7039.992188,
7142.391113,
7246.279785,
7351.679199,
7458.611816,
7567.099609,
7677.165527,
7788.832520,
7902.123535,
8017.062500,
8133.673340,
8251.980469,
8372.007812,
8493.782227,
8617.327148,
8742.668945,
8869.833984,
8998.848633,
9129.739258,
9262.534180,
9397.260742,
9533.947266,
9672.622070,
9813.313477,
9956.050781,
10100.865234,
10247.785156,
10396.842773,
10548.068359,
10701.493164,
10857.150391,
11015.071289,
11175.289062,
11337.836914,
11502.750000,
11670.061523,
11839.805664,
12012.019531,
12186.738281,
12363.999023,
12543.836914,
12726.291016,
12911.399414,
13099.200195,
13289.732422,
13483.036133,
13679.151367,
13878.119141,
14079.980469,
14284.778320,
14492.555664,
14703.354492,
14917.219727,
15134.195312,
15354.327148,
15577.661133,
15804.243164,
16034.121094,
16267.342773,
16503.957031,
16744.011719,
16987.558594,
17234.648438,
17485.332031,
17739.662109,
17997.691406,
18259.474609,
18525.064453,
18794.517578,
19067.888672,
19345.238281,
19626.621094,
19912.095703,
20201.724609,
20495.564453,
20793.679688,
21096.130859,
21402.980469,
21714.294922,
22030.136719,
22350.572266,
22675.667969,
23005.494141,
23340.115234,
23679.605469,
24024.033203,
24373.470703,
24727.990234,
25087.667969,
25452.576172,
25822.791016,
26198.392578,
26579.457031,
26966.064453,
27358.294922,
27756.230469};

inline float f_pit_midi_note_to_hz_fast(float a_midi_note_number)
{
    a_midi_note_number = a_midi_note_number * 4;
    
    if(a_midi_note_number > arr_pit_p2f_count)
        a_midi_note_number = arr_pit_p2f_count;
    
    if(a_midi_note_number < 0)
        a_midi_note_number = 0;
    
    return f_linear_interpolate_arr(arr_pit_p2f, a_midi_note_number);
}

#ifdef	__cplusplus
}
#endif

#endif	/* PITCH_CORE_H */

